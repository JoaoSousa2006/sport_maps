!<!DOCTYPE html>
<html lang="pt-br">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    
    <link
      href="https://cdn.jsdelivr.net/npm/remixicon@4.3.0/fonts/remixicon.css"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="style_index.css" />
    <title>Web Design Mastery | SoulTravel</title>
  </head>
  <body>
    <nav>
      <div class="nav__header">
        <div class="nav__logo">
          <a href="">Sport<span>Maps</span>.</a>
        </div>
        <div class="nav__menu__btn" id="menu-btn">
          <span><i class="ri-menu-line"></i></span>
        </div>
      </div>
      <ul class="nav__links" id="nav-links">
          <li><a href="cad_local.html">Adicionar Local</a></li>
        <li><a href="lista_locais.php">Buscar Locais</a></li>
      </ul>
      <div class="nav__btns">
        <a href="cadUser.html" class="btn sign__up">Cadastro</a>
        <a href="logIn.html" class="btn sign__in">Login</a>

      </div>
    </nav>
    <header class="header__container">
            <div class="local__details">
              <h1><span data-field="nome"></span></h1>
              <p><strong>Endereço:</strong> <span data-field="endereco"></span></p>
              <p><strong>Telefone:</strong> <span data-field="telefone"></span></p>
              <p><strong>Esporte:</strong> <span data-field="esporte"></span></p>
              <p><strong>Preço:</strong> <span data-field="preco"></span></p>
              <p><strong>Descrição:</strong> Um ótimo local para a prática de skate com pistas de qualidade e segurança.</p>
              <div class="votes">
                <button id="upvote">👍</button>
                <span id="votesCount">0</span>
                <button id="downvote">👎</button>
              </div>

              <div class="local__images">
                <h3>Imagens do Local</h3>
                <div class="image__slider">
                  <button class="prev" onclick="mudarSlide(-1)">&#10094;</button>
                  <img id="imagemAtual" src="img/local1.jpg" alt="Imagem do local" />
                  <button class="next" onclick="mudarSlide(1)">&#10095;</button>
                </div>
              </div>              
            </div>
    
            <div class="comments__section">
              <h2>Comentários</h2>
              <button class="btn_comentar" onclick='abrirFormulario()'>Comentar</button>
              <div class="comments__list">
                <div class="comment">
                  <p><strong>Maria:</strong> Lugar incrível, muito bem cuidado!</p>
                </div>
                <div class="comment">
                  <p><strong>João:</strong> Poderia ter iluminação à noite.</p>
                </div>
                <!-- Mais comentários serão carregados dinamicamente aqui -->
              </div>
            </div>
          </div>
        </div>
      </header>
      <div id="comentarioModal" class="modal">
        <div class="modal-content">
          <span class="fechar" onclick='fecharFormulario()'>&times;</span>
          <h3>Novo Comentário</h3>
          <form class="form__content" id="formComentario">
            <textarea placeholder="Escreva seu comentário" rows="4" required name="comentario"></textarea>
            <button type="submit" class="btn_comentar">Enviar</button>
          </form>
        </div>
      </div>
      <script>
      document.addEventListener('DOMContentLoaded', function() {
        // Supondo que o idPlace venha da URL, ex: LocalDetalhes.html?idPlace=1
        const params = new URLSearchParams(window.location.search);
        const idPlace = params.get('idPlace');

        if (idPlace) {
          fetch('getLocal.php?idPlace=' + idPlace)
            .then(response => response.json())
            .then(data => {
              if (data.erro) {
                alert(data.erro);
              } else {
                document.querySelector('.local__details [data-field="nome"]').textContent = data.NamePlace;
                document.querySelector('.local__details [data-field="endereco"]').textContent = data.AdressPlace;
                document.querySelector('.local__details [data-field="telefone"]').textContent = data.PhonePlace;
                document.querySelector('.local__details [data-field="esporte"]').textContent = data.SportType;
                document.querySelector('.local__details [data-field="preco"]').textContent = data.PricePlace;
                // Continue para outros campos
              }
            });
        }
      });
      </script>
      <script>
        const imagens = [
          "img/local1.jpg",
          "img/local2.jpg",
          "img/local3.jpg"
        ];
        let indiceAtual = 0;
      
        function mudarSlide(direcao) {
          indiceAtual += direcao;
          if (indiceAtual < 0) indiceAtual = imagens.length - 1;
          if (indiceAtual >= imagens.length) indiceAtual = 0;
          document.getElementById("imagemAtual").src = imagens[indiceAtual];
        }
      </script>
      <script>
        function abrirFormulario() {
          document.getElementById("comentarioModal").classList.add("ativa");
        }
      
        function fecharFormulario() {
          document.getElementById("comentarioModal").classList.remove("ativa");
        }
      </script>
      <script>
        // Código para comentários dinâmicos
        document.addEventListener('DOMContentLoaded', function() {
          // Envio do comentário
          document.getElementById('formComentario').addEventListener('submit', function(e) {
            e.preventDefault();
            const comentario = this.comentario.value;
            const params = new URLSearchParams(window.location.search);
            const idPlace = params.get('idPlace');
            fetch('../addComentario.php', {
              method: 'POST',
              headers: {'Content-Type': 'application/x-www-form-urlencoded'},
              body: `idPlace=${idPlace}&comentario=${encodeURIComponent(comentario)}`
            })
            .then(r => r.json())
            .then(data => {
              if (data.sucesso) {
                this.reset();
                carregarComentarios();
                fecharFormulario();
              } else {
                alert(data.erro || 'Erro ao enviar comentário');
              }
            });
          });

          // Carregar comentários
          function carregarComentarios() {
            const params = new URLSearchParams(window.location.search);
            const idPlace = params.get('idPlace');
            fetch('../getComentarios.php?idPlace=' + idPlace)
              .then(r => r.json())
              .then(comentarios => {
                const secao = document.querySelector('.comments__section');
                // Remove comentários antigos
                secao.querySelectorAll('.comment').forEach(el => el.remove());
                // Adiciona novos
                comentarios.forEach(c => {
                  const div = document.createElement('div');
                  div.className = 'comment';
                  div.innerHTML = `<p><strong>${c.NameUser}:</strong> ${c.ContentFeedback}</p>`;
                  secao.appendChild(div);
                });
              });
          }
          carregarComentarios();
        });
      </script>
      <script>
        function atualizarVotos() {
          const params = new URLSearchParams(window.location.search);
          const idPlace = params.get('idPlace');
          fetch('../vote.php', {
            method: 'POST',
            headers: {'Content-Type': 'application/x-www-form-urlencoded'},
            body: `idPlace=${idPlace}&vote=0`
          })
          .then(r => r.json())
          .then(data => {
            document.getElementById('votesCount').textContent = data.total;
          });
        }
        document.getElementById('upvote').onclick = function() {
          votar(1);
        };
        document.getElementById('downvote').onclick = function() {
          votar(-1);
        };
        function votar(vote) {
          const params = new URLSearchParams(window.location.search);
          const idPlace = params.get('idPlace');
          fetch('../vote.php', {
            method: 'POST',
            headers: {'Content-Type': 'application/x-www-form-urlencoded'},
            body: `idPlace=${idPlace}&vote=${vote}`
          })
          .then(r => r.json())
          .then(data => {
            document.getElementById('votesCount').textContent = data.total;
          });
        }
        atualizarVotos();
      </script>
    </body>
</html>
