!<!DOCTYPE html>
<html lang="pt-br">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    
    <link
      href="https://cdn.jsdelivr.net/npm/remixicon@4.3.0/fonts/remixicon.css"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="style_index.css" />
    <title>Web Design Mastery | SoulTravel</title>
  </head>
  <body>
    <nav>
      <div class="nav__header">
        <div class="nav__logo">
          <a href="">Sport<span>Maps</span>.</a>
        </div>
        <div class="nav__menu__btn" id="menu-btn">
          <span><i class="ri-menu-line"></i></span>
        </div>
      </div>
      <ul class="nav__links" id="nav-links">
          <li><a href="cad_local.html">Adicionar Local</a></li>
        <li><a href="lista_locais.php">Buscar Locais</a></li>
      </ul>
      <div class="nav__btns">
        <a href="cadUser.html" class="btn sign__up">Cadastro</a>
        <a href="logIn.html" class="btn sign__in">Login</a>

      </div>
    </nav>
    <header class="header__container">
            <div class="local__details">
              <h1><span data-field="nome"></span></h1>
              <p><strong>Endere칞o:</strong> <span data-field="endereco"></span></p>
              <p><strong>Telefone:</strong> <span data-field="telefone"></span></p>
              <p><strong>Esporte:</strong> <span data-field="esporte"></span></p>
              <p><strong>Pre칞o:</strong> <span data-field="preco"></span></p>
              <p><strong>Descri칞칚o:</strong> Um 칩timo local para a pr치tica de skate com pistas de qualidade e seguran칞a.</p>
              <div class="votes">
                <button id="upvote">游녨</button>
                <span id="votesCount">0</span>
                <button id="downvote">游녩</button>
              </div>

              <div class="local__images">
                <h3>Imagens do Local</h3>
                <div class="image__slider">
                  <button class="prev" onclick="mudarSlide(-1)">&#10094;</button>
                  <img id="imagemAtual" src="img/local1.jpg" alt="Imagem do local" />
                  <button class="next" onclick="mudarSlide(1)">&#10095;</button>
                </div>
              </div>              
            </div>
    
            <div class="comments__section">
              <h2>Coment치rios</h2>
              <button class="btn_comentar" onclick='abrirFormulario()'>Comentar</button>
              <div class="comments__list">
                <!-- Coment치rios ser칚o carregados aqui dinamicamente -->
              </div>
            </div>
          </div>
        </div>
      </header>
      <div id="comentarioModal" class="modal">
        <div class="modal-content">
          <span class="fechar" onclick='fecharFormulario()'>&times;</span>
          <h3>Novo Coment치rio</h3>
          <form class="form__content" id="formComentario">
            <textarea placeholder="Escreva seu coment치rio" rows="4" required name="comentario"></textarea>
            <button type="submit" class="btn_comentar">Enviar</button>
          </form>
        </div>
      </div>
      <script>
        // C칩digo para carregar os detalhes do local
        document.addEventListener('DOMContentLoaded', function() {
          // Obt칠m os par칙metros da URL
          const params = new URLSearchParams(window.location.search);
          // Pega o valor do par칙metro idPlace
          const idPlace = params.get('idPlace');

          // Se houver um idPlace na URL
          if (idPlace) {
        // Faz uma requisi칞칚o para obter os dados do local
        fetch('getLocal.php?idPlace=' + idPlace)
          .then(response => response.json()) // Converte a resposta para JSON
          .then(data => {
            // Se houver erro, exibe um alerta
            if (data.erro) {
          alert(data.erro);
            } else {
          // Preenche os campos da p치gina com os dados recebidos
          document.querySelector('.local__details [data-field="nome"]').textContent = data.NamePlace;
          document.querySelector('.local__details [data-field="endereco"]').textContent = data.AdressPlace;
          document.querySelector('.local__details [data-field="telefone"]').textContent = data.PhonePlace;
          document.querySelector('.local__details [data-field="esporte"]').textContent = data.SportType;
          document.querySelector('.local__details [data-field="preco"]').textContent = data.PricePlace;
          // Continue para outros campos se necess치rio
            }
          });
          }
        });
      </script>
      <script>
        // Array com os caminhos das imagens do slider
        const imagens = [
          "img/local1.jpg",
          "img/local2.jpg",
          "img/local3.jpg"
        ];
        // 칈ndice da imagem atualmente exibida
        let indiceAtual = 0;
      
        // Fun칞칚o para mudar o slide de imagem
        function mudarSlide(direcao) {
          // Atualiza o 칤ndice conforme a dire칞칚o (1 ou -1)
          indiceAtual += direcao;
          // Se passar do in칤cio, volta para a 칰ltima imagem
          if (indiceAtual < 0) indiceAtual = imagens.length - 1;
          // Se passar do final, volta para a primeira imagem
          if (indiceAtual >= imagens.length) indiceAtual = 0;
          // Atualiza o src da imagem exibida
          document.getElementById("imagemAtual").src = imagens[indiceAtual];
        }
      </script>
      <script>
        // Fun칞칚o para abrir o modal do formul치rio de coment치rio
        function abrirFormulario() {
          document.getElementById("comentarioModal").classList.add("ativa");
        }
      
        // Fun칞칚o para fechar o modal do formul치rio de coment치rio
        function fecharFormulario() {
          document.getElementById("comentarioModal").classList.remove("ativa");
        }
      </script>
      <script>
        // C칩digo para coment치rios din칙micos
        document.addEventListener('DOMContentLoaded', function() {
          // Adiciona evento de submit ao formul치rio de coment치rio
          document.getElementById('formComentario').addEventListener('submit', function(e) {
        e.preventDefault(); // Impede o envio padr칚o do formul치rio
        const comentario = this.comentario.value; // Pega o valor do textarea
        const params = new URLSearchParams(window.location.search);
        const idPlace = params.get('idPlace');
        // Envia o coment치rio via POST para o servidor
        fetch('../addComentario.php', {
          method: 'POST',
          headers: {'Content-Type': 'application/x-www-form-urlencoded'},
          body: `idPlace=${idPlace}&comentario=${encodeURIComponent(comentario)}`
        })
        .then(r => r.json()) // Converte resposta para JSON
        .then(data => {
          // Se sucesso, limpa o formul치rio, recarrega coment치rios e fecha o modal
          if (data.sucesso) {
            this.reset();
            carregarComentarios();
            fecharFormulario();
          } else {
            // Se erro, exibe alerta
            alert(data.erro || 'Erro ao enviar coment치rio');
          }
        });
          });

          // Fun칞칚o para carregar coment치rios do servidor
          function carregarComentarios() {
            const params = new URLSearchParams(window.location.search);
            const idPlace = params.get('idPlace');
            fetch('getComentarios.php?idPlace=' + idPlace)
              .then(r => r.json())
              .then(comentarios => {
                const lista = document.querySelector('.comments__list');
                lista.innerHTML = '';
                comentarios.forEach(c => {
                  const div = document.createElement('div');
                  div.className = 'comment';
                  div.innerHTML = `<p><strong>${c.NameUser}:</strong> ${c.ContentFeedback}</p>`;
                  lista.appendChild(div);
                });
              });
          }
          
          carregarComentarios(); // Carrega os coment치rios ao iniciar a p치gina

          // Adiciona evento de submit ao formul치rio de coment치rio
          document.getElementById('formComentario').addEventListener('submit', function(e) {
            e.preventDefault();
            const comentario = this.comentario.value;
            const params = new URLSearchParams(window.location.search);
            const idPlace = params.get('idPlace');
            fetch('addComentario.php', {
              method: 'POST',
              headers: {'Content-Type': 'application/x-www-form-urlencoded'},
              body: `idPlace=${idPlace}&comentario=${encodeURIComponent(comentario)}`
            })
            .then(r => r.json())
            .then(data => {
              if (data.sucesso) {
                this.reset();
                carregarComentarios();
                fecharFormulario();
              } else {
                alert(data.erro || 'Erro ao enviar coment치rio');
              }
            });
          });
        });
      </script>
      <script>
        // Fun칞칚o para atualizar a contagem de votos
        function atualizarVotos() {
          const params = new URLSearchParams(window.location.search);
          const idPlace = params.get('idPlace');
          // Envia requisi칞칚o para obter o total de votos
          fetch('vote.php', {
          method: 'POST',
          headers: {'Content-Type': 'application/x-www-form-urlencoded'},
          body: `idPlace=${idPlace}&vote=0`
          })
          .then(r => r.json()) // Converte resposta para JSON
          .then(data => {
          // Atualiza o texto com o total de votos
            document.getElementById('votesCount').textContent = data.total;
          });
        }
        // Evento para bot칚o de upvote
        document.getElementById('upvote').onclick = function() {
          votar(1);
        };
        // Evento para bot칚o de downvote
        document.getElementById('downvote').onclick = function() {
          votar(-1);
        };
        // Fun칞칚o para votar (1 para upvote, -1 para downvote)
        function votar(vote) {
          const params = new URLSearchParams(window.location.search);
          const idPlace = params.get('idPlace');
          // Envia o voto para o servidor
          fetch('vote.php', {
        method: 'POST',
        headers: {'Content-Type': 'application/x-www-form-urlencoded'},
        body: `idPlace=${idPlace}&vote=${vote}`
          })
          .then(r => r.json()) // Converte resposta para JSON
          .then(data => {
        // Atualiza o texto com o total de votos
        document.getElementById('votesCount').textContent = data.total;
          });
        }
        // Atualiza a contagem de votos ao carregar a p치gina
        atualizarVotos();
      </script>
    </body>
</html>
